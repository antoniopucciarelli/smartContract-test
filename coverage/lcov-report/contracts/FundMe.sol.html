<!doctype html>
<html lang="en">
<head>
    <title>Code coverage report for contracts/FundMe.sol</title>
    <meta charset="utf-8" />
    <link rel="stylesheet" href="../prettify.css" />
    <link rel="stylesheet" href="../base.css" />
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <style type='text/css'>
        .coverage-summary .sorter {
            background-image: url(../sort-arrow-sprite.png);
        }
    </style>
</head>
<body>
<div class='wrapper'>
  <div class='pad1'>
    <h1>
      <a href="../index.html">all files</a> / <a href="index.html">contracts/</a> FundMe.sol
    </h1>
    <div class='clearfix'>
      <div class='fl pad1y space-right2'>
        <span class="strong">95.65% </span>
        <span class="quiet">Statements</span>
        <span class='fraction'>22/23</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">75% </span>
        <span class="quiet">Branches</span>
        <span class='fraction'>6/8</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">88.89% </span>
        <span class="quiet">Functions</span>
        <span class='fraction'>8/9</span>
      </div>
      <div class='fl pad1y space-right2'>
        <span class="strong">96% </span>
        <span class="quiet">Lines</span>
        <span class='fraction'>24/25</span>
      </div>
    </div>
  </div>
  <div class='status-line high'></div>
<pre><table class="coverage">
<tr><td class="line-count quiet">1
2
3
4
5
6
7
8
9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75
76
77
78
79
80
81
82
83
84
85
86
87
88
89
90
91
92
93
94
95
96
97
98
99
100
101
102
103
104
105
106
107
108
109
110
111
112
113
114
115
116
117
118
119
120
121
122
123
124
125
126
127
128
129
130
131
132
133
134
135
136
137
138
139
140
141
142
143
144
145
146
147
148
149
150
151
152
153
154
155
156</td><td class="line-coverage quiet"><span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">4×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">17×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-yes">16×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-yes">7×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">2×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-yes">6×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-no">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">3×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">11×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-yes">1×</span>
<span class="cline-any cline-neutral">&nbsp;</span>
<span class="cline-any cline-neutral">&nbsp;</span></td><td class="text"><pre class="prettyprint lang-js">// SPDX-License-Identifier: MIT
pragma solidity ^0.8.0;
&nbsp;
// get funds from users
// withdraw funds
// set a minimum fund values in USD
&nbsp;
// importing libraries
import "./PriceConverter.sol";
import "hardhat/console.sol";
&nbsp;
// error generation
error FundMe__NotOwner();
&nbsp;
/** @title A contract for crowdfunding
 *  @author Antonio Pucciarelli
 *  @notice Demo of simple funding
 *  @dev This implement price feed as our library
 */
contract FundMe {
    // the .sol works for uint256 input data -&gt; msg.value is uint256 so it can be called into the PriceConverter.sol library
    using PriceConverter for uint256;
    // setting up global variables
    // -&gt; works but not very gas efficient =&gt; uint256 public minimumUSD = 1 * 1e18; // 18 after the number
    // AIM: reduce gas cost
    // -- using constants --&gt; makes a huge difference in gas cost
    uint256 public constant MINIMUM_USD = 1 * 1e18; // with constant we reduce 19e+3 wei gas
  
    // tracking addresses that fund the project
    address[] public s_funders;
    mapping(address =&gt; uint256) public s_addressToAmountFunded;
&nbsp;
    // setting up owner address variable
    address private immutable i_owner; // immutable saves gas and it allows to set the value of a variable just once
    // usually immutable variables are called with i_* -&gt; this because solidity stores directly in the code of the contract and not in a byte allocation
&nbsp;
    AggregatorV3Interface public s_priceFeed;
&nbsp;
    modifier onlyOwner() {
        // !!! the strings in solidity have a cost
        // require(msg.sender == i_owner, "The calling address does not match the contract deployer");
        if (
            msg.sender != i_owner
        ) // more gas efficient with an if statement -&gt; not saving the string in the solidity code
        {
            revert FundMe__NotOwner();
        }
        _; // _; represents the rest of the code when onlyOwner is called
    }
&nbsp;
    // constructor in solidity -&gt; function that is called when i deploy a contract
    // tells in this case who the owenr actually is
    constructor(address s_priceFeedAddress) {
        i_owner = msg.sender;
        s_priceFeed = AggregatorV3Interface(s_priceFeedAddress);
    }
&nbsp;
    // what happends if someone sends this contract eth without calling the fund function
    // function to prevent this
    // 1) reveive
    // 2) fallback
&nbsp;
    // try to:
    // if someone sends to us money, we'll keep transaction and elaborate it --&gt; this happens if the user does not interact correctly with the fund() function
    //receive() external payable {
    //    // if someone doesn't call the fund() function but sends money -&gt; receive calls automatically the fund() function
    //    fund();
    //}
&nbsp;
    //fallback() external payable {
    //    // if someone doesn't call the fund() function but sends money with calldata -&gt; receive calls automatically the fund() function
    //    fund();
    //}
&nbsp;
    /** @notice This function funds this contract 
     */
    // public allows everyone to call this function
    function fund() public payable {
        // payable -&gt; allows transfering eth
&nbsp;
        // require is a condition
        // msg stands for message
        require(
            msg.value.getConversionRate(s_priceFeed) &gt;= MINIMUM_USD,
            "The value is not enough!"
        );
        // reverts -&gt; stops the operation and from now on, if the require is not fullfilled -&gt; sends ther remaining value bac
        s_funders.push(msg.sender); // stores the address of the sender to the s_funders array
        s_addressToAmountFunded[msg.sender] = msg.value; // maps the amount from each sender to a mapping array
    }
&nbsp;
    function withdraw() public onlyOwner {
        // requiring the the address that is withdrawing the funds is the actuall owner of the contract -&gt; set up at the deployment of the contract
        // 1 option -&gt; require(msg.sender == owner, "The calling address is not the owner");
&nbsp;
        // loop generation
        // for starting index -&gt; ending index -&gt; step amount
        for (
            uint256 funderIndex = 0;
            funderIndex &lt; s_funders.length;
            funderIndex = funderIndex + 1
        ) {
            address funder = s_funders[funderIndex];
            s_addressToAmountFunded[funder] = 0;
        }
&nbsp;
        // reset the array
        s_funders = new address[](0); // completely blank new array with 1 element (0+1)
&nbsp;
        // withdraw the funds -&gt; 3 ways
        // 1) transfer
        // msg.sender = address
        // payable(msg.sender) = payable address
        //payable(msg.sender).transfer(address(this).balance); // -&gt; returns error if the transfer is not alright
&nbsp;
        // 2) send
        //bool sendSuccess = payable(msg.sender).send(address(this).balance);
        //require(sendSuccess, "Error in sending"); // it only reverts the transcaction if require command is called -&gt; need to test the send command
&nbsp;
        // 3) call
        // call("") means that we want to call this function but with no name
        (bool callSuccess, ) = payable(msg.sender).call{
            value: address(this).balance
        }("");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(callSuccess, "Call failed");
    }
&nbsp;
    function cheaperWithdraw() public payable onlyOwner{
        // instead of constantly reading from storage as the withdraw function -&gt; we consume a lot of gas
        // we save storage-variable into memory-variable
        address[] memory funders = s_funders;
        for(uint256 funderIndex = 0; funderIndex &lt; funders.length; funderIndex++){
            address funder = s_funders[funderIndex];
            s_addressToAmountFunded[funder] = 0;
        } 
        s_funders = new address[](0);
        (bool success, ) = i_owner.call{value: address(this).balance}("");
        <span class="missing-if-branch" title="else path not taken" >E</span>require(success);
    }
&nbsp;
<span class="fstat-no" title="function not covered" >    function getOwner() public view returns(address){</span>
<span class="cstat-no" title="statement not covered" >        return i_owner;</span>
    }
&nbsp;
    function getFunder(uint256 index) public view returns (address){
        return s_funders[index];
    }
&nbsp;
    function getAddressToAmountFunded(address funder) public view returns(uint256){
       return s_addressToAmountFunded[funder]; 
    }
&nbsp;
    function getPriceFeed() public view returns (AggregatorV3Interface) {
        return s_priceFeed;
    }
}</pre></td></tr>
</table></pre>
<div class='push'></div><!-- for sticky footer -->
</div><!-- /wrapper -->
<div class='footer quiet pad2 space-top1 center small'>
  Code coverage
  generated by <a href="http://istanbul-js.org/" target="_blank">istanbul</a> at Mon Jul 04 2022 20:03:26 GMT+0200 (Central European Summer Time)
</div>
</div>
<script src="../prettify.js"></script>
<script>
window.onload = function () {
        if (typeof prettyPrint === 'function') {
            prettyPrint();
        }
};
</script>
<script src="../sorter.js"></script>
</body>
</html>
